<!DOCTYPE html>
<html>
    <head>
      <title>Circle of Notes</title>
      <script src="processing.js"></script>
      <script src="tone.js"></script>
    </head>
    <body>
<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
<script type="text/processing" data-processing-target="mycanvas">

///// variables /////
// bool sound = false;
// Audio audio = new Audio();

int offset0 = 0;
int offset1 = -PI/2;
int offset2 = 0;
int offset3 = 0;
bool visible = true;

PFont fontA = loadFont("Times New Roman");
PFont fontB = loadFont("Courier New");

var synth;
var tone = 440;

///// END variables /////

///// setup /////
void setup() {
    size(550, 550); // pixel size of sketch
    smooth();

    synth = new Tone.Synth().toMaster();

}
///// END setup /////

///// loop /////
void draw() {
    background(255);
    fill(150);
    textFont(fontB, 50);
    textAlign(LEFT);
    text("< -1", 0, 50);
    text("<<< -7", 0, height);
    textAlign(RIGHT);
    text("+1 >", width, 50);
    text("+7 >>>", width, height);

    translate(width/2, height/2);

    noStroke();
    fill(visible ? 150:100);
    ellipse(0, 0, 0.9*width, 0.9*height);

    createNotes();
    createIntervals();
    createKeys();
    createSquares();
}
///// END loop /////

void createNotes(){
    int d = -0.7*height/2;
    int f = 50;
    textAlign(CENTER);
    pushMatrix();
        rotate((offset0*0.0003)*TWO_PI+offset1);
        fill(10); noStroke();
        arc(0, -0.9*height/2, 30, 30, -PI, 0);
        pushMatrix();
            rotate(0*PI/6); translate(0, d);
            fill(255);
            textFont(fontA, f);
            text("A",  0, 0);
        popMatrix();
        pushMatrix();
            rotate(1*PI/6); translate(0, d);
            fill(0);
            textFont(fontA, f/2);
            text("A#", -10, -f/2); text("Bb", 10, 0);
        popMatrix();
        pushMatrix();
            rotate(2*PI/6); translate(0, d);
            fill(255);
            textFont(fontA, f);
            text("B",  0, 0);
        popMatrix();
        pushMatrix();
            rotate(3*PI/6); translate(0, d);
            textFont(fontA, f);
            fill(255);
            text("C",  0, 0);
        popMatrix();
        pushMatrix();
            rotate(4*PI/6); translate(0, d);
            fill(0);
            rect(0, 100, 10, 100);
            textFont(fontA, f/2);
            text("C#", -10, -f/2); text("Db", 10, 0);
        popMatrix();
        pushMatrix();
            rotate(5*PI/6); translate(0, d);
            fill(255);
            textFont(fontA, f);
            text("D", 0, 0);
        popMatrix();
        pushMatrix();
            rotate(6*PI/6); translate(0, d);
            fill(0);
            textFont(fontA, f/2);
            text("D#", -10, -f/2); text("Eb", 10, 0);
        popMatrix();
        pushMatrix();
            rotate(7*PI/6); translate(0, d);
            fill(255);
            textFont(fontA, f);
            text("E",  0, 0);
        popMatrix();
        pushMatrix();
            rotate(8*PI/6); translate(0, d);
            fill(255);
            textFont(fontA, f);
            text("F",  0, 0);
        popMatrix();
        pushMatrix();
            rotate(9*PI/6); translate(0, d);
            fill(0);
            textFont(fontA, f/2);
            text("F#", -10, -f/2); text("Gb", 10, 0);
        popMatrix();
        pushMatrix();
            rotate(10*PI/6); translate(0, d);
            fill(255);
            textFont(fontA, f);
            text("G",  0, 0);
        popMatrix();
        pushMatrix();
            rotate(11*PI/6); translate(0, d);
            fill(0);
            textFont(fontA, f/2);
            text("G#", -10, -f/2); text("Ab", 10, 0);
        popMatrix();
    popMatrix();
}

void createIntervals(){
    if(visible){
    int d = -0.55*height/2;
    int f = 30;
    int step = -32*PI/60;
    noFill(); stroke(0); strokeWeight(2);
    ellipse(0, 0, 0.9*width, 0.9*height);
    textAlign(CENTER);
    rectMode(CENTER);
    pushMatrix();
        offset3 = offset3 % TWO_PI;
        rotate((offset2*0.0003)*TWO_PI+offset3);
        pushMatrix();
            rotate(0*PI/6);
        noStroke(); fill(0x8800ddaa);
        arc(0, 0, -d*2.35, -d*2.35, step, step+19.5*PI/60);
        stroke(0); fill(0); noFill();
            translate(0, d);
            textFont(fontA, f);
            fill(10);
            ellipse(0, -10, 30, 30);
            fill(200);
            text("1",  0, 0);
            fill(0); noFill();
            rect(0, -f*2, f*2, f*2);
        popMatrix();
        pushMatrix();
            rotate(2*PI/6);
        noStroke(); fill(0x8800ddaa);
        arc(0, 0, -d*2.35, -d*2.35, step, step+19.5*PI/60);
        stroke(0); fill(0); noFill();
            translate(0, d);
            textFont(fontA, f);
            text("2",  0, 0);
            rect(0, -f*2, f*2, f*2);
        popMatrix();
        pushMatrix();
            rotate(4*PI/6);
        noStroke(); fill(0x88006666);
        arc(0, 0, -d*2.35, -d*2.35, step, step+9.5*PI/60);
        stroke(0); fill(0); noFill();
            translate(0, d);
            textFont(fontA, f);
            text("3", 0, 0);
            rect(0, -f*2, f*2, f*2);
        popMatrix();
        pushMatrix();
            rotate(5*PI/6);
        noStroke(); fill(0x8800ddaa);
        arc(0, 0, -d*2.35, -d*2.35, step, step+19.5*PI/60);
        stroke(0); fill(0); noFill();
            translate(0, d);
            textFont(fontA, f);
            text("4", 0, 0);
            rect(0, -f*2, f*2, f*2);
        popMatrix();
        pushMatrix();
            rotate(7*PI/6);
        noStroke(); fill(0x8800ddaa);
        arc(0, 0, -d*2.35, -d*2.35, step, step+19.5*PI/60);
        stroke(0); fill(0); noFill();
            translate(0, d);
            textFont(fontA, f);
            text("5",  0, 0);
            rect(0, -f*2, f*2, f*2);
        popMatrix();
        pushMatrix();
            rotate(9*PI/6);
        noStroke(); fill(0x8800ddaa);
        arc(0, 0, -d*2.35, -d*2.35, step, step+19.5*PI/60);
        stroke(0); fill(0); noFill();
            translate(0, d);
            textFont(fontA, f);
            text("6", 0, 0);
            rect(0, -f*2, f*2, f*2);
        popMatrix();
        pushMatrix();
            rotate(11*PI/6);
        noStroke(); fill(0x88006666);
        arc(0, 0, -d*2.35, -d*2.35, step, step+9.5*PI/60);
        stroke(0); fill(0); noFill();
            translate(0, d);
            textFont(fontA, f);
            text("7", 0, 0);
            rect(0, -f*2, f*2, f*2);
        popMatrix();


        noStroke(); fill(150);
        ellipse(0, 0, -d*1.9, -d*1.9);
        pushMatrix();
            rotate(1*PI/6);
            translate(0, -0.76*height/2);
            rect(0, 0, f*2, f*2);
        popMatrix();
        pushMatrix();
            rotate(3*PI/6);
            translate(0, -0.76*height/2);
            rect(0, 0, f*2, f*2);
        popMatrix();
        pushMatrix();
            rotate(6*PI/6);
            translate(0, -0.76*height/2);
            rect(0, 0, f*2, f*2);
        popMatrix();
        pushMatrix();
            rotate(8*PI/6);
            translate(0, -0.76*height/2);
            rect(0, 0, f*2, f*2);
        popMatrix();
        pushMatrix();
            rotate(10*PI/6);
            translate(0, -0.76*height/2);
            rect(0, 0, f*2, f*2);
        popMatrix();
    popMatrix();
    }
}

void createKeys(){
    int d = -0.7*height/2;
    int f = 50;
    rectMode(CENTER);
    pushMatrix();
        rotate((offset0*0.0003)*TWO_PI+offset1);
        pushMatrix();
            rotate(0*PI/6); translate(0, d);
            fill(255);
            rect(0, 100, 20, 100);
        popMatrix();
        pushMatrix();
            rotate(1*PI/6); translate(0, d);
            fill(0);
            rect(0, 100, 10, 100);
        popMatrix();
        pushMatrix();
            rotate(2*PI/6); translate(0, d);
            fill(255);
            rect(0, 100, 20, 100);
        popMatrix();
        pushMatrix();
            rotate(3*PI/6); translate(0, d);
            fill(255);
            rect(0, 100, 20, 100);
        popMatrix();
        pushMatrix();
            rotate(4*PI/6); translate(0, d);
            fill(0);
            rect(0, 100, 10, 100);
        popMatrix();
        pushMatrix();
            rotate(5*PI/6); translate(0, d);
            fill(255);
            rect(0, 100, 20, 100);
        popMatrix();
        pushMatrix();
            rotate(6*PI/6); translate(0, d);
            fill(0);
            rect(0, 100, 10, 100);
        popMatrix();
        pushMatrix();
            rotate(7*PI/6); translate(0, d);
            fill(255);
            rect(0, 100, 20, 100);
        popMatrix();
        pushMatrix();
            rotate(8*PI/6); translate(0, d);
            fill(255);
            rect(0, 100, 20, 100);
        popMatrix();
        pushMatrix();
            rotate(9*PI/6); translate(0, d);
            fill(0);
            rect(0, 100, 10, 100);
        popMatrix();
        pushMatrix();
            rotate(10*PI/6); translate(0, d);
            fill(255);
            rect(0, 100, 20, 100);
        popMatrix();
        pushMatrix();
            rotate(11*PI/6); translate(0, d);
            fill(0);
            rect(0, 100, 10, 100);
        popMatrix();
    popMatrix();
}

void createSquares(){
    if(visible){
    int d = -0.55*height/2;
    int f = 30;
    int step = -32*PI/60;
    noFill(); stroke(0); strokeWeight(2);
    ellipse(0, 0, 0.9*width, 0.9*height);
    textAlign(CENTER);
    rectMode(CENTER);
    rotate((offset2*0.0003)*TWO_PI+offset3);
    noFill();
    pushMatrix();
        rotate(0*PI/6);
        translate(0, d);
        rect(0, -f*2, f*2, f*2);
    popMatrix();
    pushMatrix();
        rotate(2*PI/6);
        translate(0, d);
        rect(0, -f*2, f*2, f*2);
    popMatrix();
    pushMatrix();
        rotate(4*PI/6);
        translate(0, d);
        rect(0, -f*2, f*2, f*2);
    popMatrix();
    pushMatrix();
        rotate(5*PI/6);
        translate(0, d);
        rect(0, -f*2, f*2, f*2);
    popMatrix();
    pushMatrix();
        rotate(7*PI/6);
        translate(0, d);
        rect(0, -f*2, f*2, f*2);
    popMatrix();
    pushMatrix();
        rotate(9*PI/6);
        translate(0, d);
        rect(0, -f*2, f*2, f*2);
    popMatrix();
    pushMatrix();
        rotate(11*PI/6);
        translate(0, d);
        rect(0, -f*2, f*2, f*2);
    popMatrix();


    int d1 = -0.7*height/2;
    rectMode(CENTER);
    noStroke(); fill(150);
    pushMatrix();
        rotate(1*PI/6);
        translate(0, d1*1.1);
        rect(0, 0, f*2, f*2);
        rect(0, 120, 22, 104);
    popMatrix();
    pushMatrix();
        rotate(3*PI/6);
        translate(0, d1*1.1);
        rect(0, 0, f*2, f*2);
        rect(0, 120, 22, 104);
    popMatrix();
    pushMatrix();
        rotate(6*PI/6);
        translate(0, d1*1.1);
        rect(0, 0, f*2, f*2);
        rect(0, 120, 22, 104);
    popMatrix();
    pushMatrix();
        rotate(8*PI/6);
        translate(0, d1*1.1);
        rect(0, 0, f*2, f*2);
        rect(0, 120, 22, 104);
    popMatrix();
    pushMatrix();
        rotate(10*PI/6);
        translate(0, d1*1.1);
        rect(0, 0, f*2, f*2);
        rect(0, 120, 22, 104);
    popMatrix();
    }
}

void mouseDragged(){
    int dy = mouseY-pmouseY;
    if(mouseX < width/2) dy = -dy;
    int dx = mouseX-pmouseX;
    if(mouseY > height/2) dx = -dx;
    if(keyPressed && keyCode == SHIFT)
        offset2 += abs(dx)>abs(dy) ? dx : dy;
    else
        offset0 += abs(dx)>abs(dy) ? dx : dy;
}

void keyPressed(){
    if(key == '-'){
        offset1 -= PI/6;
    }
    if(key == '='){
        offset1 += PI/6;
    }
    if(key == '+'){
        offset1 -= 7*PI/6;
    }
    if(key == '_'){
        offset1 += 7*PI/6;
    }
    if(key == 'v'){
        visible = !visible;
    }
    if(key == ','){
        offset3 -= PI/6;
    }
    if(key == '.'){
        offset3 += PI/6;
    }
}

void mouseClicked(){
    if(mouseX>0 && mouseX<130 && mouseY>0 && mouseY<130){
        offset1 -= PI/6;
    }
    if(mouseX>width-130 && mouseX<width && mouseY>0 && mouseY<130){
        offset1 += PI/6;
    }
    if(mouseX>0 && mouseX<130 && mouseY>height-130 && mouseY<height){
        offset1 += 7*PI/6;
    }
    if(mouseX>width-130 && mouseX<width && mouseY>height-130 && mouseY<height){
        offset1 -= 7*PI/6;
    }
    if(mouseX>width/2-50 && mouseX<width/2+50 && mouseY>height/2-50 && mouseY<height/2+50){
        visible = !visible;
    }
    if(mouseX>0 && mouseX<130 && mouseY>0 && mouseY<130){
        offset1 -= PI/6;
    }
    synth.triggerAttackRelease(440, "8n");
}

</script>
<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
        <canvas id="mycanvas"></canvas>
    </body>
</html>

